<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Sistema de Gestión de Alimentos</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">

</head>
<header>
    <!--TODO: según el rol pasado por parámetro cargar un menú distinto -->
    <div th:insert="~{fragments/menu :: menuprincipal(${username})}"></div>
    <div class="card-body">
        <div th:if="${success}" class="alert alert-success text-center">
            <p>Operación Realizada Correctamente</p>
        </div>
    </div>
    <div class="card-body">
        <div th:if="${error}" class="alert alert-success text-center">
            <p>Operación Realizada Correctamente</p>
        </div>
    </div>
</header>
<body>
    <div class="container mt-5" id="sector_central_vistas">
        <!-- Centrar texto usando las clases text-center y mt-5 para margen superior -->
        <h1 class="text-center">Bienvenido/a al Sistema de Gestión de Alimentos</h1>
        <p class="text-center mt-3">Este es el contenido compartido que se muestra a todos los usuarios
            (podría ser un mapa de las heladeras informando ubicación, capacidad, viandas, estado, etc.)
        </p>
        <h2>Selecciona una opción para ver su contenido</h2>
        <!--todo: analizar si va como vista preliminar el mapa = <div th:insert="~{fragments/map :: mapBody(lat=${lat}, lon=${lon})}"></div>-->
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

</body>
</html>

<!-- analizar
    opcion 1:
    function loadContent(url) {
        fetch(url)
            .then(response => response.text())
            .then(data => {
                document.getElementById("dynamic-content").innerHTML = data;
            })
            .catch(error => console.error('Error al cargar el contenido:', error));
    }

    // opcion 2:
    function cargarFragmento(nombreFragmento) {
        window.location.href = '/home?fragmento=' + nombreFragmento;
    }
-->
<script>
    let viandaCount = 1; // Contador para las viandas

    function agregarVianda() {
        const viandaContainer = document.getElementById('viandaContainer');

        // Crear un nuevo contenedor de vianda
        const newVianda = document.createElement('div');
        newVianda.classList.add('vianda-item', 'border', 'rounded-lg', 'p-4', 'space-y-4', 'mb-4');

        // Agregar contenido de la nueva vianda
        newVianda.innerHTML = `
    <h3 class="text-lg font-medium">Vianda ${viandaCount + 1}</h3>
    <div>
      <label for="comida_${viandaCount}" class="block text-sm font-medium text-gray-700">Comida</label>
      <input type="text" id="comida_${viandaCount}" name="viandas[${viandaCount}].comida" required
             class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
    </div>
    <div>
      <label for="fechaCaducidad_${viandaCount}" class="block text-sm font-medium text-gray-700">Fecha de Caducidad</label>
      <input type="date" id="fechaCaducidad_${viandaCount}" name="viandas[${viandaCount}].fechaCaducidad" required
             class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
    </div>
    <div>
      <label for="calorias_${viandaCount}" class="block text-sm font-medium text-gray-700">Calorías</label>
      <input type="number" id="calorias_${viandaCount}" name="viandas[${viandaCount}].calorias" step="0.01" required
             class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
    </div>
    <div>
      <label for="peso_${viandaCount}" class="block text-sm font-medium text-gray-700">Peso (en gramos)</label>
      <input type="number" id="peso_${viandaCount}" name="viandas[${viandaCount}].peso" step="0.01" required
             class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
    </div>
    <button type="button"
            class="w-full inline-flex justify-center rounded-md border border-gray-300 bg-red-500 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-red-600"
            onclick="removeVianda(this)">
      Eliminar Vianda
    </button>
  `;

        // Incrementar el contador
        viandaCount++;

        // Añadir el nuevo contenedor de vianda al contenedor de viandas
        viandaContainer.appendChild(newVianda);
    }

    function removeVianda(button) {
        const viandaItem = button.closest('.vianda-item');
        viandaItem.remove();
    }

</script>
<script>
    function cargarVista(opcion) {
        // URL del endpoint que devuelve la opcion seleccionada con los parámetros ya cargados para su renderizacion
        const url = `/vistas/${opcion}`; // Responde el controller VistasController.java

        // Realiza la solicitud fetch
        fetch(url, { method: 'GET' })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Error al cargar la vista: ${response.statusText}`);
                }
                return response.text(); // Obtiene el HTML como texto
            })
            .then(html => {
                // Inserta el contenido en el contenedor
                document.getElementById("sector_central_vistas").innerHTML = html;
            })
            .catch(error => {
                console.error('Error al cargar la vista:', error);
            });
    }

</script>
